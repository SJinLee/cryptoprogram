# MTI/A0 (2자간 인증된 키 교환) 프로토콜 설명

MTI/A0는 2자간 키 동의 프로토콜로, 디피-헬만의 가장 큰 약점인 **중간자 공격(Man-in-the-Middle Attack)을 방지**하기 위해 '인증' 기능을 내장한 방식입니다.

*   **목표:** 앨리스와 밥 두 사람이 통신할 때, 서로가 진짜 앨리스와 밥이 맞는지 확인하면서(인증), 안전한 세션 키를 합의하는 것.
*   **핵심 아이디어:** 두 종류의 키를 함께 사용합니다.
    1.  **장기 키 (Long-term Key):** 신분증처럼 사용되는, 한 번 설정하고 계속 사용하는 키.
    2.  **임시 세션 키 (Ephemeral Key):** 일회용으로, 현재 통신 세션에서만 사용하고 버리는 키.

---

### 1. 사전 준비: 장기 키 설정

앨리스와 밥은 통신을 시작하기 전, 각자의 장기 키를 설정하고 신뢰할 수 있는 방법으로 서로의 **'공개키'**를 교환해 둡니다. (예: 인증서(CA)를 통해 교환)

*   **앨리스:**
    *   장기 비밀키: `a`
    *   장기 공개키: `z_a = g^a mod p`
*   **밥:**
    *   장기 비밀키: `b`
    *   장기 공개키: `z_b = g^b mod p`

(여기서 `g`와 `p`는 모두가 동의한 공개된 값입니다.)

---

### 2. 키 합의 과정 (실제 통신 시)

**[ 1단계 ] : 임시 세션 키 생성 및 교환**

각 통신 세션마다, 앨리스와 밥은 새로운 임시 키를 만듭니다.

*   앨리스는 임시 비밀키 `x`를 무작위로 선택하고, 임시 공개키 `A = g^x mod p`를 계산하여 **밥에게 보냅니다.**
*   밥은 임시 비밀키 `y`를 무작위로 선택하고, 임시 공개키 `B = g^y mod p`를 계산하여 **앨리스에게 보냅니다.**

이 `A`와 `B`는 중간에 공격자가 엿봐도 괜찮습니다.

**[ 2단계 ] : 최종 공유 키 계산 (각자 독립적으로)**

앨리스와 밥은 이제 각자 받은 정보와 자신이 가진 정보를 조합하여 최종 키 `K`를 계산합니다.

*   **앨리스의 계산:**
    `K_A = (밥의 임시 공개키)^자신의 임시 비밀키 * (밥의 장기 공개키)^자신의 장기 비밀키`
    `K_A = (B)^x * (z_b)^a  mod p`

*   **밥의 계산:**
    `K_B = (앨리스의 임시 공개키)^자신의 임시 비밀키 * (앨리스의 장기 공개키)^자신의 장기 비밀키`
    `K_B = (A)^y * (z_a)^b  mod p`

**[ 결과 확인 ]**

두 계산 결과가 정말 같은지 수식으로 증명해 보겠습니다.

*   앨리스의 계산 결과:
    `K_A = (g^y)^x * (g^b)^a = g^(yx) * g^(ba) = g^(xy + ab) mod p`
*   밥의 계산 결과:
    `K_B = (g^x)^y * (g^a)^b = g^(xy) * g^(ab) = g^(xy + ab) mod p`

보시다시피, `K_A`와 `K_B`는 **완벽하게 동일**합니다. 이 값이 바로 두 사람의 안전한 세션 키가 됩니다.

---

### 이 방식이 왜 안전한가? (인증 효과)

공격자 '맬로리'가 중간에서 앨리스를 사칭한다고 가정해 봅시다.

1.  맬로리는 자신의 임시 키 `M = g^m mod p`를 밥에게 보냅니다 (자기가 앨리스인 척).
2.  밥은 `M`을 받고, 위 공식에 따라 최종 키를 계산합니다.
    `K_Bob = (M)^y * (z_a)^b = (g^m)^y * (g^a)^b = g^(my + ab) mod p`
3.  이때, 맬로리도 밥과 똑같은 키를 만들어내야 통신이 가능합니다. 맬로리가 키를 계산하려면 `(B)^m * (z_a)^?` 를 계산해야 하는데, 두 번째 항인 `(z_a)^?` 를 계산하려면 **앨리스의 장기 비밀키 `a`**가 필요합니다.
4.  맬로리는 `a`를 모르기 때문에, 절대 밥과 동일한 키를 만들 수 없습니다.

결과적으로 밥과 맬로리는 서로 다른 키를 갖게 되므로 통신은 실패하고, 밥은 상대방이 진짜 앨리스가 아님을 알 수 있습니다. 이처럼 MTI/A0는 **장기 키(`a`, `b`)를 인증 수단으로 활용**하여 중간자 공격을 효과적으로 방어합니다.