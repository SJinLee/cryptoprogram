{% extends "base.html" %}

{% block title %}ElGamal 전자서명{% endblock %}

{% block content %}
    <h1>ElGamal 전자서명</h1>
    <p>ElGamal 전자서명은 이산 로그 문제의 어려움에 기반한 공개키 암호화 방식입니다. RSA와 마찬가지로 전자서명에 활용됩니다.</p>

    <h2>ElGamal 전자서명 과정:</h2>

    <h3>1. 키 생성</h3>
    <ol>
        <li>큰 소수 p를 선택합니다.</li>
        <li>p의 원시근(primitive root) g를 선택합니다.</li>
        <li>개인키 x를 1 < x < p-1 범위에서 무작위로 선택합니다.</li>
        <li>공개키 y = g^x mod p를 계산합니다.</li>
    </ol>
    <p>공개키는 (p, g, y)이고, 개인키는 (x)입니다.</p>

    <h3>2. 서명 (Signing)</h3>
    <ol>
        <li>서명할 메시지 M을 해시 함수 H를 사용하여 해시 값 h = H(M)을 계산합니다.</li>
        <li>1 < k < p-1 이고 gcd(k, p-1) = 1인 무작위 정수 k를 선택합니다.</li>
        <li>r = g^k mod p를 계산합니다.</li>
        <li>s = (h - x*r) * k^(-1) mod (p-1)을 계산합니다. (여기서 k^(-1)는 k의 (p-1)에 대한 모듈러 역원)</li>
    </ol>
    <p>메시지 M과 서명 (r, s)를 수신자에게 전송합니다.</p>

    <h3>3. 검증 (Verification)</h3>
    <ol>
        <li>수신자는 서명자로부터 받은 메시지 M을 해시 함수 H를 사용하여 해시 값 h' = H(M)을 계산합니다.</li>
        <li>수신자는 다음 두 값을 계산합니다:</li>
            <ul>
                <li>v1 = (y^r * r^s) mod p</li>
                <li>v2 = g^(h') mod p</li>
            </ul>
        <li>v1과 v2를 비교합니다. 두 값이 일치하면 서명이 유효한 것으로 간주됩니다.</li>
    </ol>

    <h2>ElGamal 전자서명 실험</h2>

    <h3>키 생성</h3>
    <form method="POST" action="{{ url_for('elgamal_signature') }}">
        <label for="elgamal_p">소수 p:</label>
        <input type="number" id="elgamal_p" name="p" value="{{ elgamal_p if elgamal_p is not none else '' }}" required>
        <label for="elgamal_g">원시근 g:</label>
        <input type="number" id="elgamal_g" name="g" value="{{ elgamal_g if elgamal_g is not none else '' }}" required>
        <label for="elgamal_x">개인키 x:</label>
        <input type="number" id="elgamal_x" name="x" value="{{ elgamal_x if elgamal_x is not none else '' }}" required>
        <button type="submit" name="elgamal_operation" value="generate_keys">키 생성</button>
        {% if elgamal_y is not none %}
            <p>공개키 y: {{ elgamal_y }}</p>
        {% endif %}
        {% if elgamal_key_error is not none %}
            <p style="color: red;">오류: {{ elgamal_key_error }}</p>
        {% endif %}
    </form>

    <h3>서명</h3>
    <form method="POST" action="{{ url_for('elgamal_signature') }}">
        <label for="elgamal_message_sign">메시지:</label>
        <input type="text" id="elgamal_message_sign" name="message" value="{{ elgamal_message_sign if elgamal_message_sign is not none else '' }}" required>
        <label for="elgamal_p_sign">소수 p:</label>
        <input type="number" id="elgamal_p_sign" name="p" value="{{ session_elgamal_p if session_elgamal_p is not none else (elgamal_p_sign if elgamal_p_sign is not none else '') }}" required>
        <label for="elgamal_g_sign">원시근 g:</label>
        <input type="number" id="elgamal_g_sign" name="g" value="{{ session_elgamal_g if session_elgamal_g is not none else (elgamal_g_sign if elgamal_g_sign is not none else '') }}" required>
        <label for="elgamal_x_sign">개인키 x:</label>
        <input type="number" id="elgamal_x_sign" name="x" value="{{ session_elgamal_x if session_elgamal_x is not none else (elgamal_x_sign if elgamal_x_sign is not none else '') }}" required>
        <label for="elgamal_k_sign">무작위 정수 k:</label>
        <input type="number" id="elgamal_k_sign" name="k" value="{{ elgamal_k_sign if elgamal_k_sign is not none else '' }}" required>
        <button type="submit" name="elgamal_operation" value="sign">서명</button>
        {% if elgamal_r_result is not none %}
            <p>서명 (r): {{ elgamal_r_result }}</p>
            <p>서명 (s): {{ elgamal_s_result }}</p>
        {% endif %}
        {% if elgamal_sign_error is not none %}
            <p style="color: red;">오류: {{ elgamal_sign_error }}</p>
        {% endif %}
    </form>

    <h3>검증</h3>
    <form method="POST" action="{{ url_for('elgamal_signature') }}">
        <label for="elgamal_message_verify">메시지:</label>
        <input type="text" id="elgamal_message_verify" name="message" value="{{ elgamal_message_verify if elgamal_message_verify is not none else '' }}" required>
        <label for="elgamal_r_verify">서명 r:</label>
        <input type="number" id="elgamal_r_verify" name="r" value="{{ elgamal_r_verify if elgamal_r_verify is not none else '' }}" required>
        <label for="elgamal_s_verify">서명 s:</label>
        <input type="number" id="elgamal_s_verify" name="s" value="{{ elgamal_s_verify if elgamal_s_verify is not none else '' }}" required>
        <label for="elgamal_p_verify">소수 p:</label>
        <input type="number" id="elgamal_p_verify" name="p" value="{{ session_elgamal_p if session_elgamal_p is not none else (elgamal_p_verify if elgamal_p_verify is not none else '') }}" required>
        <label for="elgamal_g_verify">원시근 g:</label>
        <input type="number" id="elgamal_g_verify" name="g" value="{{ session_elgamal_g if session_elgamal_g is not none else (elgamal_g_verify if elgamal_g_verify is not none else '') }}" required>
        <label for="elgamal_y_verify">공개키 y:</label>
        <input type="number" id="elgamal_y_verify" name="y" value="{{ session_elgamal_y if session_elgamal_y is not none else (elgamal_y_verify if elgamal_y_verify is not none else '') }}" required>
        <button type="submit" name="elgamal_operation" value="verify">검증</button>
        {% if elgamal_verification_result is not none %}
            <p>검증 결과: {{ elgamal_verification_result }}</p>
        {% endif %}
        {% if elgamal_verify_error is not none %}
            <p style="color: red;">오류: {{ elgamal_verify_error }}</p>
        {% endif %}
    </form>
{% endblock %}