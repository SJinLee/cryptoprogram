{% extends "base.html" %}

{% block title %}KCDSA 표준{% endblock %}

{% block content %}
    <h1>KCDSA (Korean Certificate-based Digital Signature Algorithm) 표준</h1>
    <p>KCDSA는 대한민국에서 개발하고 국가 표준으로 제정한 인증서 기반 디지털 서명 알고리즘입니다.</p>

    <h2>주요 특징:</h2>
    <ul>
        <li><strong>인증서 기반:</strong> 공개키 기반 구조(PKI) 환경에서 인증서와 함께 사용되도록 설계되었습니다.</li>
        <li><strong>이산 로그 문제 기반:</strong> DSA, ElGamal과 유사하게 유한체에서의 이산 로그 문제의 계산적 어려움에 보안을 의존합니다.</li>
        <li><strong>국가 표준:</strong> 한국의 IT 환경과 법적 프레임워크에 맞춰 개발되었으며, 정부 시스템, 금융 서비스 등에서 활용됩니다.</li>
        <li><strong>해시 함수:</strong> HAS-160 또는 SHA-256/SHA-384/SHA-512와 같은 표준 해시 함수를 사용합니다.</li>
    </ul>

    <h2>KCDSA 서명 과정 (자세한 설명):</h2>

    <h3>1. 파라미터 생성 (p, q, g)</h3>
    <p>KCDSA는 DSA와 유사하게 시스템 파라미터 p, q, g를 사용합니다. 이 파라미터들은 표준에 명시된 절차에 따라 생성되어야 합니다.</p>
    <ol>
        <li>큰 소수 p를 선택합니다. (예: 1024비트 또는 2048비트)</li>
        <li>p-1의 소수 인수 q를 선택합니다. (예: 160비트 또는 256비트)</li>
        <li>g = h^((p-1)/q) mod p를 만족하는 생성자 g를 선택합니다. (1 < h < p-1)</li>
    </ol>

    <h3>2. 키 생성</h3>
    <ol>
        <li>개인키 x를 0 < x < q 범위에서 무작위로 선택합니다. (단, gcd(x, q) = 1)</li>
        <li>공개키 y = g^(x^(-1)) mod p를 계산합니다. (여기서 x^(-1)는 x의 q에 대한 모듈러 역원)</li>
    </ol>
    <p>공개키는 (p, q, g, y)이고, 개인키는 (x)입니다.</p>

    <h3>3. 서명 (Signing)</h3>
    <ol>
        <li>0 < k < q 인 무작위 정수 k를 선택합니다.</li>
        <li>w = g^k mod p를 계산합니다.</li>
        <li>r = H(w)를 계산합니다. (여기서 H는 SHA-256을 사용하며, r은 q를 법으로 하는 정수입니다.)</li>
        <li>z = y mod 2^l (l은 해쉬함수의 블록 크기, SHA-256의 경우 512비트)</li>
        <li>서명할 메시지 M을 해시 함수 H를 사용하여 해시 값 h = H(z||M)을 계산합니다. (여기서 h는 SHA-256을 사용하며, h는 q를 법으로 하는 정수입니다.)</li>
        <li>e = (r xor h) mod q를 계산합니다.</li>
        <li>s = x (k - e) mod q를 계산합니다. (s가 0이면 다른 k를 선택)</li>
    </ol>
    <p>메시지 M과 서명 (r, s)를 수신자에게 전송합니다.</p>

    <h3>4. 검증 (Verification)</h3>
    <ol>
        <li>서명 (r, s)가 0 < r < q 이고 0 < s < q를 만족하는지 확인합니다.</li>
        <li>z = y mod 2^l (l은 해쉬함수의 블록 크기, SHA-256의 경우 512비트)</li>
        <li>서명자로부터 받은 메시지 M을 해시 함수 H를 사용하여 해시 값 h' = H(z||M)을 계산합니다. (여기서 h'는 SHA-256을 사용하며, h'는 q를 법으로 하는 정수입니다.)</li>
        <li>e' = (r xor h') mod q를 계산합니다.</li>
        <li>v = (g^e' * y^s) mod p를 계산합니다.</li>
        <li>r' = H(v)를 계산합니다. (여기서 H는 SHA-256을 사용하며, r'은 q를 법으로 하는 정수입니다.)</li>
        <li>r'와 r을 비교합니다. 두 값이 일치하면 서명이 유효한 것으로 간주됩니다.</li>
    </ol>

    <h2>KCDSA 전자서명 실험</h2>

    <h3>키 및 파라미터 생성</h3>
    <form method="POST" action="{{ url_for('kcdsa') }}">
        <label for="kcdsa_L">p의 비트 길이 (L):</label>
        <input type="number" id="kcdsa_L" name="L" value="{{ request.form.L if request.form.L is not none else 512 }}" required>
        <label for="kcdsa_N">q의 비트 길이 (N):</label>
        <input type="number" id="kcdsa_N" name="N" value="{{ request.form.N if request.form.N is not none else 160 }}" required>
        <button type="submit" name="kcdsa_operation" value="generate_keys">파라미터 및 키 생성</button>
        {% if kcdsa_p is not none %}
            <p>p: {{ kcdsa_p }}</p>
            <p>q: {{ kcdsa_q }}</p>
            <p>g: {{ kcdsa_g }}</p>
            <p>x (개인키): {{ kcdsa_x }}</p>
            <p>y (공개키): {{ kcdsa_y }}</p>
        {% endif %}
        {% if kcdsa_key_error is not none %}
            <p style="color: red;">오류: {{ kcdsa_key_error }}</p>
        {% endif %}
    </form>

    <h3>서명</h3>
    <form method="POST" action="{{ url_for('kcdsa') }}">
        <label for="kcdsa_message_sign">메시지:</label>
        <input type="text" id="kcdsa_message_sign" name="message" value="{{ kcdsa_message_sign if kcdsa_message_sign is not none else '' }}" required>
        <label for="kcdsa_p_sign">p:</label>
        <input type="number" id="kcdsa_p_sign" name="p" value="{{ session_kcdsa_p if session_kcdsa_p is not none else (kcdsa_p_sign if kcdsa_p_sign is not none else '') }}" required>
        <label for="kcdsa_q_sign">q:</label>
        <input type="number" id="kcdsa_q_sign" name="q" value="{{ session_kcdsa_q if session_kcdsa_q is not none else (kcdsa_q_sign if kcdsa_q_sign is not none else '') }}" required>
        <label for="kcdsa_g_sign">g:</label>
        <input type="number" id="kcdsa_g_sign" name="g" value="{{ session_kcdsa_g if session_kcdsa_g is not none else (kcdsa_g_sign if kcdsa_g_sign is not none else '') }}" required>
        <label for="kcdsa_x_sign">개인키 x:</label>
        <input type="number" id="kcdsa_x_sign" name="x" value="{{ session_kcdsa_x if session_kcdsa_x is not none else (kcdsa_x_sign if kcdsa_x_sign is not none else '') }}" required>
        <label for="kcdsa_k_sign">무작위 정수 k:</label>
        <input type="number" id="kcdsa_k_sign" name="k" value="{{ kcdsa_k_sign if kcdsa_k_sign is not none else '' }}" required>
        <button type="submit" name="kcdsa_operation" value="sign">서명</button>
        {% if kcdsa_r_result is not none %}
            <p>서명 (r): {{ kcdsa_r_result }}</p>
            <p>서명 (s): {{ kcdsa_s_result }}</p>
        {% endif %}
        {% if kcdsa_sign_error is not none %}
            <p style="color: red;">오류: {{ kcdsa_sign_error }}</p>
        {% endif %}
    </form>

    <h3>검증</h3>
    <form method="POST" action="{{ url_for('kcdsa') }}">
        <label for="kcdsa_message_verify">메시지:</label>
        <input type="text" id="kcdsa_message_verify" name="message" value="{{ kcdsa_message_verify if kcdsa_message_verify is not none else '' }}" required>
        <label for="kcdsa_r_verify">서명 r:</label>
        <input type="number" id="kcdsa_r_verify" name="r" value="{{ kcdsa_r_verify if kcdsa_r_verify is not none else '' }}" required>
        <label for="kcdsa_s_verify">서명 s:</label>
        <input type="number" id="kcdsa_s_verify" name="s" value="{{ kcdsa_s_verify if kcdsa_s_verify is not none else '' }}" required>
        <label for="kcdsa_p_verify">p:</label>
        <input type="number" id="kcdsa_p_verify" name="p" value="{{ session_kcdsa_p if session_kcdsa_p is not none else (kcdsa_p_verify if kcdsa_p_verify is not none else '') }}" required>
        <label for="kcdsa_q_verify">q:</label>
        <input type="number" id="kcdsa_q_verify" name="q" value="{{ session_kcdsa_q if session_kcdsa_q is not none else (kcdsa_q_verify if kcdsa_q_verify is not none else '') }}" required>
        <label for="kcdsa_g_verify">g:</label>
        <input type="number" id="kcdsa_g_verify" name="g" value="{{ session_kcdsa_g if session_kcdsa_g is not none else (kcdsa_g_verify if kcdsa_g_verify is not none else '') }}" required>
        <label for="kcdsa_y_verify">공개키 y:</label>
        <input type="number" id="kcdsa_y_verify" name="y" value="{{ session_kcdsa_y if session_kcdsa_y is not none else (kcdsa_y_verify if kcdsa_y_verify is not none else '') }}" required>
        <button type="submit" name="kcdsa_operation" value="verify">검증</button>
        {% if kcdsa_verification_result is not none %}
            <p>검증 결과: {{ kcdsa_verification_result }}</p>
        {% endif %}
        {% if kcdsa_verify_error is not none %}
            <p style="color: red;">오류: {{ kcdsa_verify_error }}</p>
        {% endif %}
    </form>
{% endblock %}