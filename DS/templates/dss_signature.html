{% extends "base.html" %}

{% block title %}DSS (DSA) 전자서명{% endblock %}

{% block content %}
    <h1>DSS (DSA) 전자서명</h1>
    <p>DSS (Digital Signature Standard)는 미국 NIST에서 제정한 디지털 서명 표준이며, DSA (Digital Signature Algorithm)는 이 표준의 핵심 알고리즘입니다. DSA는 이산 로그 문제의 어려움에 기반합니다.</p>

    <h2>DSA 전자서명 과정:</h2>

    <h3>1. 파라미터 생성 (p, q, g)</h3>
    <ol>
        <li>큰 소수 p를 선택합니다. (L 비트 길이)</li>
        <li>p-1의 소인수인 작은 소수 q를 선택합니다. (N 비트 길이)</li>
        <li>g = h^((p-1)/q) mod p를 만족하는 생성자 g를 선택합니다. (1 < h < p-1)</li>
    </ol>

    <h3>2. 키 생성</h3>
    <ol>
        <li>개인키 x를 0 < x < q 범위에서 무작위로 선택합니다.</li>
        <li>공개키 y = g^x mod p를 계산합니다.</li>
    </ol>
    <p>공개키는 (p, q, g, y)이고, 개인키는 (x)입니다.</p>

    <h3>3. 서명 (Signing)</h3>
    <ol>
        <li>서명할 메시지 M을 해시 함수 H를 사용하여 해시 값 h = H(M)을 계산합니다. (h는 q로 나눈 나머지)</li>
        <li>0 < k < q 이고 gcd(k, q) = 1인 무작위 정수 k를 선택합니다.</li>
        <li>r = (g^k mod p) mod q를 계산합니다. (r이 0이면 다른 k를 선택)</li>
        <li>s = (k^(-1) * (h + x*r)) mod q를 계산합니다. (s가 0이면 다른 k를 선택)</li>
    </ol>
    <p>메시지 M과 서명 (r, s)를 수신자에게 전송합니다.</p>

    <h3>4. 검증 (Verification)</h3>
    <ol>
        <li>수신자는 서명자로부터 받은 메시지 M을 해시 함수 H를 사용하여 해시 값 h' = H(M)을 계산합니다. (h'는 q로 나눈 나머지)</li>
        <li>서명 (r, s)가 0 < r < q 이고 0 < s < q를 만족하는지 확인합니다.</li>
        <li>w = s^(-1) mod q를 계산합니다.</li>
        <li>u1 = (h' * w) mod q를 계산합니다.</li>
        <li>u2 = (r * w) mod q를 계산합니다.</li>
        <li>v = ((g^u1 * y^u2) mod p) mod q를 계산합니다.</li>
        <li>v와 r을 비교합니다. 두 값이 일치하면 서명이 유효한 것으로 간주됩니다.</li>
    </ol>

    <h2>DSA 전자서명 실험</h2>

    <h3>키 및 파라미터 생성</h3>
    <form method="POST" action="{{ url_for('dss_signature') }}">
        <label for="dsa_L">p의 비트 길이 (L):</label>
        <input type="number" id="dsa_L" name="L" value="{{ request.form.L if request.form.L is not none else 512 }}" required>
        <label for="dsa_N">q의 비트 길이 (N):</label>
        <input type="number" id="dsa_N" name="N" value="{{ request.form.N if request.form.N is not none else 160 }}" required>
        <button type="submit" name="dsa_operation" value="generate_keys">파라미터 및 키 생성</button>
        {% if dsa_p is not none %}
            <p>p: {{ dsa_p }}</p>
            <p>q: {{ dsa_q }}</p>
            <p>g: {{ dsa_g }}</p>
            <p>x (개인키): {{ dsa_x }}</p>
            <p>y (공개키): {{ dsa_y }}</p>
        {% endif %}
        {% if dsa_key_error is not none %}
            <p style="color: red;">오류: {{ dsa_key_error }}</p>
        {% endif %}
    </form>

    <h3>서명</h3>
    <form method="POST" action="{{ url_for('dss_signature') }}">
        <label for="dsa_message_sign">메시지:</label>
        <input type="text" id="dsa_message_sign" name="message" value="{{ dsa_message_sign if dsa_message_sign is not none else '' }}" required>
        <label for="dsa_p_sign">p:</label>
        <input type="number" id="dsa_p_sign" name="p" value="{{ session_dsa_p if session_dsa_p is not none else (dsa_p_sign if dsa_p_sign is not none else '') }}" required>
        <label for="dsa_q_sign">q:</label>
        <input type="number" id="dsa_q_sign" name="q" value="{{ session_dsa_q if session_dsa_q is not none else (dsa_q_sign if dsa_q_sign is not none else '') }}" required>
        <label for="dsa_g_sign">g:</label>
        <input type="number" id="dsa_g_sign" name="g" value="{{ session_dsa_g if session_dsa_g is not none else (dsa_g_sign if dsa_g_sign is not none else '') }}" required>
        <label for="dsa_x_sign">개인키 x:</label>
        <input type="number" id="dsa_x_sign" name="x" value="{{ session_dsa_x if session_dsa_x is not none else (dsa_x_sign if dsa_x_sign is not none else '') }}" required>
        <label for="dsa_k_sign">무작위 정수 k:</label>
        <input type="number" id="dsa_k_sign" name="k" value="{{ dsa_k_sign if dsa_k_sign is not none else '' }}" required>
        <button type="submit" name="dsa_operation" value="sign">서명</button>
        {% if dsa_r_result is not none %}
            <p>서명 (r): {{ dsa_r_result }}</p>
            <p>서명 (s): {{ dsa_s_result }}</p>
        {% endif %}
        {% if dsa_sign_error is not none %}
            <p style="color: red;">오류: {{ dsa_sign_error }}</p>
        {% endif %}
    </form>

    <h3>검증</h3>
    <form method="POST" action="{{ url_for('dss_signature') }}">
        <label for="dsa_message_verify">메시지:</label>
        <input type="text" id="dsa_message_verify" name="message" value="{{ dsa_message_verify if dsa_message_verify is not none else '' }}" required>
        <label for="dsa_r_verify">서명 r:</label>
        <input type="number" id="dsa_r_verify" name="r" value="{{ dsa_r_verify if dsa_r_verify is not none else '' }}" required>
        <label for="dsa_s_verify">서명 s:</label>
        <input type="number" id="dsa_s_verify" name="s" value="{{ dsa_s_verify if dsa_s_verify is not none else '' }}" required>
        <label for="dsa_p_verify">p:</label>
        <input type="number" id="dsa_p_verify" name="p" value="{{ session_dsa_p if session_dsa_p is not none else (dsa_p_verify if dsa_p_verify is not none else '') }}" required>
        <label for="dsa_q_verify">q:</label>
        <input type="number" id="dsa_q_verify" name="q" value="{{ session_dsa_q if session_dsa_q is not none else (dsa_q_verify if dsa_q_verify is not none else '') }}" required>
        <label for="dsa_g_verify">g:</label>
        <input type="number" id="dsa_g_verify" name="g" value="{{ session_dsa_g if session_dsa_g is not none else (dsa_g_verify if dsa_g_verify is not none else '') }}" required>
        <label for="dsa_y_verify">공개키 y:</label>
        <input type="number" id="dsa_y_verify" name="y" value="{{ session_dsa_y if session_dsa_y is not none else (dsa_y_verify if dsa_y_verify is not none else '') }}" required>
        <button type="submit" name="dsa_operation" value="verify">검증</button>
        {% if dsa_verification_result is not none %}
            <p>검증 결과: {{ dsa_verification_result }}</p>
        {% endif %}
        {% if dsa_verify_error is not none %}
            <p style="color: red;">오류: {{ dsa_verify_error }}</p>
        {% endif %}
    </form>
{% endblock %}